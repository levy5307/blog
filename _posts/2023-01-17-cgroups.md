---
layout: post
title: Linux cgroups
date: 2023-01-19
Author: levy5307
tags: []
comments: true
toc: true
---

## cgroups子系统

cgroups的全称是control groups，cgroups为每种可以控制的资源定义了一个子系统。典型的子系统介绍如下：

- cpu子系统，主要限制进程的cpu使用率。

- cpuacct子系统，可以统计cgroups中的进程的cpu使用报告。

- cpuset子系统，可以为cgroups中的进程分配单独的cpu节点或者内存节点。

- memory子系统，可以限制进程的memory使用量。

- blkio子系统，可以限制进程的块设备io。

- devices子系统，可以控制进程能够访问某些设备。

- net_cls子系统，可以标记cgroups中进程的网络数据包，然后可以使用tc模块（traffic control）对数据包进行控制。

- freezer子系统，可以挂起或者恢复cgroups中的进程。

- ns子系统，可以使不同cgroups下面的进程使用不同的namespace。

这里面每一个子系统都需要与内核的其他模块配合来完成资源的控制，比如对cpu资源的限制是通过进程调度模块根据cpu子系统的配置来完成的；对内存资源的限制则是内存模块根据memory子系统的配置来完成的，而对网络数据包的控制则需要traffic control子系统来配合完成。

## cgroups hierarchy

- 什么是cgroups hierarchy？

内核使用cgroup结构体来表示一个control group对某一个或者某几个cgroups子系统的资源限制。每一棵cgroup结构体组成的树称为一个cgroups hierarchy。

cgroups hierarchy可以attach一个或者几个cgroups子系统，对其attach的cgroups子系统进行资源的限制。不过，每一个cgroups子系统只能被attach到一个cgroups hierarchy。
